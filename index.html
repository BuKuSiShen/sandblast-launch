<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯åŠ¨Sand Blast</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            position: relative;
            z-index: 1;
        }
        
        .app-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .status-area {
            margin: 30px 0;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .countdown {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 200px;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin: 15px auto;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            border-radius: 3px;
            animation: progressFill 3s linear forwards;
        }
        
        @keyframes progressFill {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        .fallback {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .btn {
            display: inline-block;
            background: #3DDC84;
            color: white;
            padding: 15px 40px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
            margin-top: 20px;
        }
        
        .tips {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 14px;
            color: #666;
        }
        
        .debug {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-icon">ğŸ’¥</div>
        <h1>Sand Blast</h1>
        <p class="subtitle">æ­£åœ¨å¯åŠ¨æ¸¸æˆ...</p>
        
        <div class="status-area">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div class="countdown" id="countdown">3</div>
                <p id="statusText">æ­£åœ¨å°è¯•æ‰“å¼€åº”ç”¨...</p>
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <p id="timerInfo" style="color: #888; font-size: 14px;">ç­‰å¾…: 0.0ç§’</p>
            </div>
            
            <div class="fallback" id="fallback">
                <p style="color: #666; margin-bottom: 20px;">åº”ç”¨æœªå®‰è£…ï¼Œæ­£åœ¨è·³è½¬åˆ°åº”ç”¨å•†åº—...</p>
                <a href="#" id="storeBtn" class="btn">ç«‹å³å‰å¾€ Google Play</a>
            </div>
        </div>
        
        <div class="tips">
            <p>ğŸ’¡ æ­£åœ¨å°è¯•æ‰“å¼€åº”ç”¨ï¼Œè¯·å‹¿ç¦»å¼€é¡µé¢...</p>
        </div>
    </div>

    <div class="debug" id="debugPanel" style="display: none;">
        <div>çŠ¶æ€: <span id="debugState">-</span></div>
        <div>æ—¶é—´: <span id="debugTime">0</span>ms</div>
        <div>å·²å”¤èµ·: <span id="debugLaunched">å¦</span></div>
    </div>

    <script>
        // ==================== é…ç½®åŒºåŸŸ ====================
        const CONFIG = {
            packageName: 'com.neweraky.sandblast',
            urlScheme: 'neweraky.sandblast',
            playStoreUrl: 'https://play.google.com/store/apps/details?id=com.agedstudio.puzzle.sand.blocks.color.blast',
            timeout: 3000, // 3ç§’è¶…æ—¶
            debug: true
        };
        // =================================================

        class SimpleAppLauncher {
            constructor(config) {
                this.config = config;
                
                // æç®€çŠ¶æ€
                this.state = {
                    appLaunched: false,      // æ˜¯å¦å·²å°è¯•å”¤èµ·
                    startTime: null,         // å¼€å§‹æ—¶é—´
                    timeoutTimer: null,      // è¶…æ—¶å®šæ—¶å™¨
                    countdownInterval: null, // å€’è®¡æ—¶å®šæ—¶å™¨
                    
                    // ç¯å¢ƒ
                    isAndroid: /Android/i.test(navigator.userAgent),
                    isWeChat: /micromessenger/i.test(navigator.userAgent.toLowerCase())
                };
                
                this.elements = {
                    loading: document.getElementById('loading'),
                    fallback: document.getElementById('fallback'),
                    countdown: document.getElementById('countdown'),
                    statusText: document.getElementById('statusText'),
                    timerInfo: document.getElementById('timerInfo'),
                    storeBtn: document.getElementById('storeBtn'),
                    debugPanel: document.getElementById('debugPanel'),
                    debugState: document.getElementById('debugState'),
                    debugTime: document.getElementById('debugTime'),
                    debugLaunched: document.getElementById('debugLaunched')
                };
                
                if (this.config.debug) {
                    this.elements.debugPanel.style.display = 'block';
                }
                
                console.log('âœ… åˆå§‹åŒ–å®Œæˆ', {
                    isAndroid: this.state.isAndroid,
                    isWeChat: this.state.isWeChat
                });
            }
            
            updateDebugInfo() {
                this.elements.debugState.textContent = this.state.appLaunched ? 'å·²å”¤èµ·' : 'æœªå”¤èµ·';
                this.elements.debugTime.textContent = this.state.startTime ? Date.now() - this.state.startTime : 0;
                this.elements.debugLaunched.textContent = this.state.appLaunched ? 'æ˜¯' : 'å¦';
            }
            
            start() {
                console.log('ğŸš€ å¼€å§‹ç®€å•å”¤èµ·æµç¨‹');
                this.state.startTime = Date.now();
                
                // å¼€å§‹3ç§’å€’è®¡æ—¶æ˜¾ç¤º
                this.startCountdown();
                
                // ç¯å¢ƒæ£€æŸ¥
                if (!this.state.isAndroid) {
                    this.showNonAndroid();
                    return;
                }
                
                if (this.state.isWeChat) {
                    this.handleWeChat();
                    return;
                }
                
                // è®¾ç½®3ç§’è¶…æ—¶ï¼ˆæ— è®ºå¦‚ä½•3ç§’åè·³è½¬å•†åº—ï¼‰
                this.state.timeoutTimer = setTimeout(() => {
                    this.goToStore();
                }, this.config.timeout);
                
                // ========== æ ¸å¿ƒé€»è¾‘ ==========
                
                // ç«‹å³å°è¯•å”¤èµ·åº”ç”¨
                this.launchAppNow();
            }
            
            startCountdown() {
                // 3ç§’å€’è®¡æ—¶UIæ˜¾ç¤º
                let countdownValue = 3;
                this.elements.countdown.textContent = countdownValue;
                
                this.state.countdownInterval = setInterval(() => {
                    const elapsed = Date.now() - this.state.startTime;
                    const remaining = Math.max(0, this.config.timeout - elapsed);
                    
                    // æ›´æ–°æ˜¾ç¤º
                    countdownValue = Math.ceil(remaining / 1000);
                    this.elements.countdown.textContent = countdownValue;
                    this.elements.timerInfo.textContent = `ç­‰å¾…: ${(elapsed / 1000).toFixed(1)}ç§’`;
                    this.updateDebugInfo();
                    
                    // 3ç§’ç»“æŸ
                    if (elapsed >= this.config.timeout) {
                        clearInterval(this.state.countdownInterval);
                    }
                }, 100);
            }
            
            launchAppNow() {
                if (this.state.appLaunched) return;
                
                this.state.appLaunched = true;
                console.log('âš¡ ç«‹å³å”¤èµ·åº”ç”¨');
                
                try {
                    // æ„å»ºå”¤èµ·URL
                    const schemeUrl = this.buildSchemeUrl();
                    console.log('å”¤èµ·URL:', schemeUrl);
                    
                    // æ–¹æ³•1ï¼šç›´æ¥locationè·³è½¬ï¼ˆä¸»æ–¹æ³•ï¼‰
                    window.location.href = schemeUrl;
                    
                    // æ–¹æ³•2ï¼šå¤‡ç”¨iframeæ–¹å¼ï¼ˆ1ç§’åå¦‚æœè¿˜åœ¨å½“å‰é¡µé¢ï¼‰
                    setTimeout(() => {
                        try {
                            const iframe = document.createElement('iframe');
                            iframe.style.cssText = 'display:none;width:0;height:0;border:none;';
                            iframe.src = schemeUrl;
                            document.body.appendChild(iframe);
                            
                            setTimeout(() => {
                                if (iframe.parentNode) {
                                    iframe.parentNode.removeChild(iframe);
                                }
                            }, 2000);
                        } catch (e) {
                            console.log('iframeå”¤èµ·å¤±è´¥:', e);
                        }
                    }, 1000);
                    
                } catch (error) {
                    console.log('å”¤èµ·å¤±è´¥:', error);
                }
                
                this.updateDebugInfo();
            }
            
            buildSchemeUrl() {
                const params = new URLSearchParams(window.location.search);
                const ref = params.get('ref');
                
                return ref 
                    ? `${this.config.urlScheme}://launch?ref=${encodeURIComponent(ref)}`
                    : `${this.config.urlScheme}://launch`;
            }
            
            goToStore() {
                console.log('ğŸ”— 3ç§’è¶…æ—¶ï¼Œè·³è½¬åº”ç”¨å•†åº—');
                
                // æ¸…ç†å®šæ—¶å™¨
                this.clearTimers();
                
                // æ˜¾ç¤ºè·³è½¬ç•Œé¢
                this.showStoreRedirect();
            }
            
            clearTimers() {
                if (this.state.timeoutTimer) {
                    clearTimeout(this.state.timeoutTimer);
                    this.state.timeoutTimer = null;
                }
                
                if (this.state.countdownInterval) {
                    clearInterval(this.state.countdownInterval);
                    this.state.countdownInterval = null;
                }
            }
            
            showStoreRedirect() {
                this.elements.loading.style.display = 'none';
                this.elements.fallback.style.display = 'block';
                
                this.elements.storeBtn.href = this.config.playStoreUrl;
                this.elements.storeBtn.onclick = (e) => {
                    e.preventDefault();
                    this.redirectToStore();
                };
                
                // 2ç§’åè‡ªåŠ¨è·³è½¬
                setTimeout(() => {
                    this.redirectToStore();
                }, 2000);
            }
            
            redirectToStore() {
                console.log('è·³è½¬åˆ°åº”ç”¨å•†åº—');
                window.location.href = this.config.playStoreUrl;
            }
            
            handleWeChat() {
                console.log('âš ï¸ å¾®ä¿¡ç¯å¢ƒï¼Œç›´æ¥è·³è½¬å•†åº—');
                this.elements.statusText.textContent = 'è¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ­¤é“¾æ¥';
                this.elements.statusText.style.color = '#dc3545';
                
                // 2ç§’åè·³è½¬
                setTimeout(() => {
                    this.redirectToStore();
                }, 2000);
            }
            
            showNonAndroid() {
                console.log('âš ï¸ éAndroidè®¾å¤‡');
                this.elements.statusText.textContent = 'æ­¤é“¾æ¥ä»…æ”¯æŒAndroidè®¾å¤‡';
                
                // 2ç§’åè·³è½¬
                setTimeout(() => {
                    this.redirectToStore();
                }, 2000);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ === æç®€å”¤èµ·æ–¹æ¡ˆ ===');
            console.log('é…ç½®:', CONFIG);
            
            const launcher = new SimpleAppLauncher(CONFIG);
            
            // ç«‹å³å¼€å§‹
            launcher.start();
            
            window.launcher = launcher;
        });
    </script>
</body>
</html>
